import{a as h}from"./index.CEvxOxeV.js";const w=5,E=6,L=10;let m=(e,i,t,r)=>(e.events=e.events||{},e.events[t+L]||(e.events[t+L]=r(l=>{e.events[t].reduceRight((n,d)=>(d(n),n),{shared:{},...l})})),e.events[t]=e.events[t]||[],e.events[t].push(i),()=>{let l=e.events[t],n=l.indexOf(i);l.splice(n,1),l.length||(delete e.events[t],e.events[t+L](),delete e.events[t+L])}),T=1e3,y=(e,i)=>m(e,r=>{let l=i(r);l&&e.events[E].push(l)},w,r=>{let l=e.listen;e.listen=(...d)=>(!e.lc&&!e.active&&(e.active=!0,r()),l(...d));let n=e.off;return e.events[E]=[],e.off=()=>{n(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let d of e.events[E])d();e.events[E]=[]}},T)},()=>{e.listen=l,e.off=n}}),M=(e={})=>{let i=h(e);return i.setKey=function(t,r){typeof r>"u"?t in i.value&&(i.value={...i.value},delete i.value[t],i.notify(t)):i.value[t]!==r&&(i.value={...i.value,[t]:r},i.notify(t))},i},g=e=>e,o={},v={addEventListener(){},removeEventListener(){}};function N(){try{return typeof localStorage<"u"}catch{return!1}}N()&&(o=localStorage);let U={addEventListener(e,i,t){window.addEventListener("storage",i),window.addEventListener("pageshow",t)},removeEventListener(e,i,t){window.removeEventListener("storage",i),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(v=U);function O(e,i=void 0,t={}){let r=t.encode||g,l=t.decode||g,n=h(i),d=n.set;n.set=f=>{typeof f>"u"?delete o[e]:o[e]=r(f),d(f)};function c(f){f.key===e?f.newValue===null?d(void 0):d(l(f.newValue)):o[e]||d(void 0)}function a(){n.set(o[e]?l(o[e]):i)}return y(n,()=>{if(a(),t.listen!==!1)return v.addEventListener(e,c,a),()=>{v.removeEventListener(e,c,a)}}),n}function R(e,i={},t={}){let r=t.encode||g,l=t.decode||g,n=M(),d=n.setKey;n.setKey=(s,u)=>{typeof u>"u"?(t.listen!==!1&&v.perKey&&v.removeEventListener(e+s,a,f),delete o[e+s]):(t.listen!==!1&&v.perKey&&!(s in n.value)&&v.addEventListener(e+s,a,f),o[e+s]=r(u)),d(s,u)};let c=n.set;n.set=function(s){for(let u in s)n.setKey(u,s[u]);for(let u in n.value)u in s||n.setKey(u)};function a(s){s.key?s.key.startsWith(e)&&(s.newValue===null?d(s.key.slice(e.length),void 0):d(s.key.slice(e.length),l(s.newValue))):c({})}function f(){let s={...i};for(let u in o)u.startsWith(e)&&(s[u.slice(e.length)]=l(o[u]));n.set(s)}return y(n,()=>{if(f(),t.listen!==!1)return v.addEventListener(e,a,f),()=>{v.removeEventListener(e,a,f);for(let s in n.value)v.removeEventListener(e+s,a,f)}}),n}export{R as a,O as p};
